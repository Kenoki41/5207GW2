---
title: 'Group Assignment 3'
author: 'Group 2'
date: "2021/2/5"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

  In this group work, we will study the relationship between the new crown epidemic in the United States in the past year and the predictors we selected. First, we will select five predictor variables and explain why we chose these five variables. After that, we will build our theory, how the predictor variables we choose will be related to the dependent variable (COVID-19 case data). The data sets we use are county.data and covid.smooth.data_county.
  
  After establishing the theory. We will review the selected variables. We will analyze the mean, median and other data of variables and build their distribution diagrams. After that, we will use the glm() function and build a regression model to fit these predictors. Finally we will write down the main findings.
  
# Predictors select and Theory
  The five factors we used in this assignment is:
  Economic typology 2015 
  POP ESTIMATE 2018 
  POVALL_2018 
  Unemployment_rate_2018 
  Density per square mile of land area - Population 
  
  
  

## Load Data
```{r load data}

library(tidyverse)


load('Data/covid.RData')
load("Data/county.data.RData")
load("Data/google.mobility.RData")

head(covid.smooth.data_county)
head(google.mobility)
head(county.data)

```
## descriptive analysis
```{r descriptive analysis}
variable <-c('Economic_typology_2015','POP_ESTIMATE_2018','POVALL_2018','Unemployment_rate_2018','Density.per.square.mile.of.land.area...Population')

summary(county.data[variable], na.rm=TRUE)
describe(county.data[variable])
```

```{r}

library(psych)
library(tidyverse)

descData <- c('Economic_typology_2015','POP_ESTIMATE_2018','POVALL_2018', 'Unemployment_rate_2018','Density.per.square.mile.of.land.area...Population')
descDataF <- county.data %>% select('Economic_typology_2015','POP_ESTIMATE_2018','POVALL_2018', 'Unemployment_rate_2018','Density.per.square.mile.of.land.area...Population')

describe(county.data[descData], na.rm = TRUE, fast = TRUE) #clean后准备替换成新变量

bar <- ggplot(data = descDataF) + 
  geom_bar(
    mapping = aes(x = Economic_typology_2015, color = tot_cases), #清洗后用病例数对应观察分布
    show.legend = FALSE,
    width = 1,
    na.rm = TRUE
  ) + 
  theme(aspect.ratio = 1) +
  labs(x = NULL, y = NULL)

bar + coord_flip()
bar + coord_polar()

ggplot(data = descDataF) + 
  geom_bar(mapping = aes(x = population, fill = tot_cases), position = "dodge")

ggplot(data = descDataF) +
  geom_bar(mapping = aes(x = poverty, fill = poverty))

ggplot(data = descDataF) +
  geom_bar(mapping = aes(x = unemployment, fill = unemployment))

ggplot(data = descDataF) +
  geom_bar(mapping = aes(x = pop_density, fill = pop_density))



```

```{r descriptive analysis} ##变量名更改后

variable <-c('economic_type','population','poverty','unemployment','pop_density')

summary(county.data[variable], na.rm=TRUE)
describe(county.data[variable])

```

## fitting model
```{r fit the first model to county, warning=FALSE, message=FALSE, cache=FALSE}

library(tidyverse)
county.data <- county.data %>%
  mutate(z.economic = scale(economic_type)) %>%
  mutate(z.population = scale(population)) %>% 
  mutate(z.poverty = scale(poverty)) %>% 
  mutate(z.unemployment = scale(unemployment))%>%
  mutate(z.density = scale(pop_density))
```

```{r fitting model}

library(arm)
covid19.model <- glm(tot_cases ~ z.economic + z.population 
                     + z.poverty + z.unemployment + z.density,
                     family=poisson(link = log), ##泊松或者改成逻辑
                     data=booth.results.2019.Coalition)

```



